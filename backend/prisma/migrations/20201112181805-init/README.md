# Migration `20201112181805-init`

This migration has been generated by jonaed1230 at 11/13/2020, 12:18:05 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('ADMIN', 'TEACHER', 'STUDENT', 'MODERATOR')

CREATE TABLE "User" (
    "id" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "studentId" INTEGER,
    "department" TEXT NOT NULL,
    "active" BOOLEAN NOT NULL DEFAULT false,
    "role" "Role" NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Class" (
    "id" TEXT NOT NULL,
    "started" BOOLEAN NOT NULL,
    "valid" BOOLEAN NOT NULL DEFAULT true,
    "authorId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Chat" (
    "id" TEXT NOT NULL,
    "authorId" TEXT NOT NULL,
    "classId" TEXT NOT NULL,
    "text" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_ClassToUser" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "_ClassToUser_AB_unique" ON "_ClassToUser"("A", "B")

CREATE INDEX "_ClassToUser_B_index" ON "_ClassToUser"("B")

ALTER TABLE "Class" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Chat" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Chat" ADD FOREIGN KEY("classId")REFERENCES "Class"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ClassToUser" ADD FOREIGN KEY("A")REFERENCES "Class"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ClassToUser" ADD FOREIGN KEY("B")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201112181805-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,47 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id         String  @id @default(cuid())
+  email      String  @unique
+  name       String
+  studentId  Int?
+  department String
+  active     Boolean @default(false)
+  chats      Chat[]
+  classes    Class[]
+  role       Role
+  Class      Class[] @relation("Class_To_Author")
+}
+
+model Class {
+  id           String  @id @default(cuid())
+  started      Boolean
+  valid        Boolean @default(true)
+  chatlist     Chat[]
+  author       User    @relation("Class_To_Author", fields: [authorId], references: [id])
+  authorId     String
+  perticipents User[]
+}
+
+model Chat {
+  id       String @id @default(cuid())
+  author   User   @relation(fields: [authorId], references: [id])
+  authorId String
+  class    Class  @relation(fields: [classId], references: [id])
+  classId  String
+  text     String
+}
+
+enum Role {
+  ADMIN
+  TEACHER
+  STUDENT
+  MODERATOR
+}
```


